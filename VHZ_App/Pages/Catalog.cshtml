@page
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@model CatalogModel
@{
    ViewData["Title"] = "Каталог";
}

@section Styles {
    <link rel="stylesheet" href="~/css/catalog.css" />
}

<p />
<form method="post" asp-antiforgery="true" asp-page-handler="Search">
    <div class="container-fluid px-0">
        <input type="text"
               placeholder="Поиск"
               class="found-input"
               asp-for="foundPole" />
        <button type="submit" class="btn-class">Найти</button>
    </div>
</form>
<p></p>

<form method="post" asp-antiforgery="true" asp-page-handler="Filter">
    <div class="container-fluid px-0">
        <select asp-for="SelectedType" class="dropDownList">
            <option value="all">Все</option>
            <option value="Пластифицированные гранулированные ПВХ-материалы">Пластифицированные гранулированные ПВХ-материалы</option>
            <option value="Пластифицированные листовые ПВХ-материалы">Пластифицированные листовые ПВХ-материалы</option>
            <option value="Непластифицированные ПВХ-материалы">Непластифицированные ПВХ-материалы</option>
            <option value="Изделия из стеклопластика">Изделия из стеклопластика</option>
        </select>
        <button type="submit" class="btn-class">Фильтр</button>
    </div>
</form>
<p class="otstup" />

@if (!string.IsNullOrEmpty(Model.ErrorMessage))
{
    <div class="alert alert-danger">
        @Model.ErrorMessage
    </div>
}

@{
    // Группируем товары по типам
    var groupedProducts = Model.CatalogProducts
        .GroupBy(p => p.Type)
        .OrderBy(g => g.Key);
}

@foreach (var group in groupedProducts)
{
    <h3 class="product-type-header">@group.Key</h3>

    foreach (var product in group)
    {
        string way = "/Image/" + @product.Image;
        <div class="product-card-wrapper">
            <div class="card-content">
                <div class="image-container">
                    <img src="@way" alt="@product.NameProduct" class="responsive-image">
                </div>
                <div class="text-content">
                    <div class="price-section">
                        <span class="price-per">Цена за 100г</span>
                        <span class="price">@product.Price.ToString("#.##") руб</span>
                    </div>
                    <div class="product-info">
                        <h3 class="product-name">@product.NameProduct</h3>
                        <p class="product-description">@product.Appointment</p>
                        <p class="product-compliance">@product.ProductCompliance</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="product-actions">
            <form method="post" asp-page-handler="SelectProduct">
                <input type="hidden" name="idProduct" value="@product.IdProduct" />
                <button type="submit" class="details-btn">Подробнее</button>
            </form>
            <form method="post" asp-page-handler="AddCart" asp-route-idProduct="@product.IdProduct" asp-route-idUser="@Model.idUser">
                <button type="submit" class="add-basket-btn">Добавить в корзину</button>
            </form>
        </div>
        <div class="otstup"></div>
    }
}

<p></p>
<label class="end-text"></label>